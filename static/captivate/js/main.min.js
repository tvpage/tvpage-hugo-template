!function(a,b,c){var d=0,e=a(".btn-more-button"),f=a("#tvp-desktop-search-input"),g=a("#tvp-null-results"),h=a("#tvp-mobile-search-input"),i=a(".mobile-search-modal-cancel-btn"),j=a("#tvp-mobile-search-results"),k=a("#tvp-mobile-null-results"),l=!1,m=(!!/iPhone|iPad|iPod/i.test(navigator.userAgent),!1);isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),m=!1,initialPlay=!0,isFullScreen=!1,activeVideoId=null,videoList=[],isMobile=!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isMac=navigator.userAgent.indexOf("Mac OS X")!=-1,isFireFox=navigator.userAgent.indexOf("Firefox")!=-1,isFiltered=!1,IE=function(a){return RegExp("msie"+(isNaN(a)?"":"\\s"+a),"i").test(navigator.userAgent)},playerResolution=isMobile?"360p":"480p",isFlashRequired=IE(9)||IE(10)||isMac&&isFireFox,playerTechOrder=isFlashRequired?"flash,html5":"html5,flash";var n=function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"],c=new Date(1e3*Number(a)),d=b[c.getMonth()],e=""+c.getDate()+",",f=c.getFullYear();return[d,e,f].join(" ")},o={commonRequest:function(b,d,e){return a.ajax({url:b,cache:!1,dataType:"jsonp",data:c.extend({},m?s.selected:{},{p:null==d||void 0==d?0:d,n:(TVSite.isHomePage,6),s:null==e||void 0==e?"":e,"X-login-id":TVSite.loginId,status:"approved",o:"date_created",od:"desc"})})},filters:function(){return a.ajax({url:TVSite.apiUrl+"codebook/display/video",dataType:"jsonp",data:{"X-login-id":TVSite.loginId,channelId:TVSite.channelId}})},products:function(a){var b=TVSite.apiUrl+"videos/"+a+"/products";return this.commonRequest(b,null,null)},channelInfo:function(){},video:function(){},videos:function(a,b,c){var d=TVSite.apiUrl+"videos/search",e=c;return void 0!==a&&null!==a&&(d=TVSite.apiUrl+"channels/"+a+"/videos"),this.commonRequest(d,b,e)}},p={liveResultHtml:'<li><a href="{url}" class="tvp-desktop-search-results-item clearfix"><div class="tvp-desktop-search-results-item-img-holder"><div class="tvp-desktop-search-results-item-img" style="background-image:url({asset.thumbnailUrl});+    \tbackground-position: 50% 50%;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" /></div></div><div class="tvp-desktop-search-results-item-text"><p class="tvp-desktop-search-results-item-title">{title}</p><p class="tvp-desktop-search-results-item-description">{description}</p></div></a></li>',videoTemplate:'<div class="col-sm-4 col-md-4"><a href="{url}" class="latest-video"><div class="latest-video-thumbnail"><div class="content" style="background-image: url({asset.thumbnailUrl});"><div class="latest-video-hover"><div class="play-icon"></div></div></div></div><p class="latest-video-title">{title}</p></a></div>',getResultUrl:function(a){var b=function(a){return"undefined"!=typeof a&&null!==typeof a&&a};if(a&&b(a,"entityTitleParent")&&b(a,"titleTextEncoded")&&b(a,"entityIdParent")&&b(a,"id"))return TVSite.baseUrl+"/"+(l?TVSite.channelInfo.titleTextEncoded:String(a.entityTitleParent).replace(/\s/g,"-").replace(/\./g,""))+"/"+String(a.titleTextEncoded).replace(/\s/g,"-")+"/"+(a.entityIdParent||TVSite.channelId)+"-"+a.id},resetLiveSearch:function(){a("#tvp-desktop-search-results ul").empty().closest("#tvp-desktop-search-results-holder").hide()},showEndOfResults:function(){a(".tvp-end-of-results").length||(a("<p></p>").addClass("tvp-end-of-results").html("No more results").appendTo("#tvp-desktop-search-results ul"),this.checkResultsScroller())},createDesktopScroller:function(c){if(c&&a(c).children().length)return new b(c,{interactiveScrollbars:!0,scrollX:!1,click:!0,mouseWheel:!0,scrollbars:!0})},handleScrollEnd:function(){if(Math.abs(this.maxScrollY)-Math.abs(this.y)<10){var a=f.val();o.videos(null,d+1,a).done(function(a){p.handleVideoResults(a),d+=1})}},checkResultsScroller:function(){this.resultsScroller?setTimeout(function(){p.resultsScroller.refresh()},0):(this.resultsScroller=this.createDesktopScroller("#tvp-desktop-search-results-holder"),this.resultsScroller.on("scrollEnd",this.handleScrollEnd))},tmpl:function(a,b){if(a&&"object"==typeof b)return a.replace(/\{([\w\.]*)\}/g,function(a,c){for(var d=c.split("."),e=b[d.shift()],f=0,g=d.length;f<g;f++)e=e[d[f]];return"undefined"!=typeof e&&null!==e?e:""})},stripHtml:function(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""},handleVideoResults:function(b){if(b.length){for(var c="",d="#tvp-desktop-search-results-holder",e=0;e<b.length;++e){var f=b[e];f.url=this.getResultUrl(f),"description"in f&&(f.description=this.stripHtml(f.description)),c+=this.tmpl(this.liveResultHtml,f)}a("#tvp-desktop-search-results ul").append(c).closest(d).show(),p.checkResultsScroller()}else p.showEndOfResults()},handleLoadMore:function(b){for(var c="",d=0;d<b.length;++d){var e=b[d];e.url=this.getResultUrl(e),c+=this.tmpl(this.videoTemplate,e)}a("#tvp-video-container").append(c),r.onLoadMore()},addFilters:function(b){var c=function(b,c){var d=a("<a/>").attr({value:b.code,href:"#"}),e=a("<li/>");return b.id&&d.attr("id",b.id),d.html(b.label||""),e.append(d[0]),e[0]};for(var d in b){var e=document.createDocumentFragment();e.appendChild(c({code:null,label:d.replace(/_/g," ")}));for(var f=b[d].options,g=0;g<(f?f.length:0);g++)f[g].hasValues&&e.appendChild(c(f[g]));var h=a("#"+d);1===e.childElementCount?h.addClass("tvp-filter-inactive"):(h.html(e),h.removeAttr("style"))}},handleMobileSearchResults:function(a){if(a.length){var b='<li><div class="item"> <a href="{url}" class="latest-video"><div class="latest-video-thumbnail"><div class="content" style="background-image: url({asset.thumbnailUrl})"></div></div><div class="latest-video-title"> {title}</div> </a></div></li>',d="",e=this;c.each(a,function(c,f){var g=a[f];g.url=e.getResultUrl(g),d+=e.tmpl(b,g)})}},renderProd:function(b,c,d){var e="";if(b&&b.length)for(var f=0;f<b.length;f++){var g=JSON.parse(b[f].data||"");b[f].linkUrl=g.linkUrl,b[f].imageUrl=g.imageUrl,e+=p.tmpl(d,b[f])}e.length&&(a(c).html(e),a(c).length>0&&!a(c).is(":hidden"),j.find("ul").html(e).parent().show())},handleProduct:function(b){if(b.length){var d='<li><div id="{id}" class="tvp-product-image"><div class="content" style="background-image: url({imageUrl})"></div></div></li>',e="",f=this;c.each(b,function(a,c){var g=b[c];e+=f.tmpl(d,g)}),a(".tvp-products-wrapper ul").html(e)}}},q={desktop:function(a){return o.videos(null,null,a)},mobile:function(a){return o.videos(null,null,a)}},r={onLoadMore:function(){a(".latest-video").on({click:function(a){},mouseover:function(b){var c=a(this).find(".latest-video-hover");c.hasClass("active")||c.addClass("active")},mouseout:function(b){var c=a(this).find(".latest-video-hover");c.hasClass("active")&&c.removeClass("active")}})},Filters:function(){a("#product_category li a").on("click",function(b){b.preventDefault(),a(this).parent().parent().prev().find(".selected").text(a(this).text());var c=b.currentTarget.id;s.selected.product_category=b.currentTarget.text,d=0,c?s.filterVideos():s.reset()}),a("#type_of_video li a").on("click",function(b){b.preventDefault(),a(this).parent().parent().prev().find(".selected").text(a(this).text());var c=b.currentTarget.id;s.selected.type_of_video=b.currentTarget.text,d=0,c?s.filterVideos():s.reset()})}};f.on("keypress",function(a){13==a.keyCode&&a.preventDefault()}),f.on("keyup",function(b){l=!1,b.preventDefault();var c=a(b.target).val();p.resetLiveSearch(),g.find(".tvp-null-results-word").text(c),c?(d=0,q.desktop(c).done(function(a){a.length?(g.hide(),p.handleVideoResults(a)):g.show()})):g.hide()}),f.focus(function(){a(".brand-header-search-container").animate({width:"+=175"},"fast"),a(".brand-header-logo").animate({marginLeft:"-=175"},"fast")}).blur(function(){f.val(""),p.resetLiveSearch(),g.hide(),a(".brand-header-search-container").animate({width:"-=175"},"fast"),a(".brand-header-logo").animate({marginLeft:"+=175"},"fast")}),h.on("keyup",function(b){b.preventDefault();var c=a(b.target).val();c?q.mobile(c).done(function(a){a.length?(k.hide(),p.handleMobileSearchResults(a)):(j.hide(),k.find("b").html(c),k.show())}):(k.hide(),j.hide())}),i.on("click",function(a){a.preventDefault(),h.val(""),k.hide(),j.hide()}),e.on("click",function(a){l=!0,d+=1,o.videos(TVSite.channelId,d,null).done(function(a){a.length&&p.handleLoadMore(a)})});var s={selected:{},defaultFilters:null,filters:{type_of_video:{},product_category:{}},reset:function(){a(".tvp-filter-reset").css("display","none"),m=!1,d=0,a("#tvp-video-container").empty(),o.videos(TVSite.channelId,d,null).done(function(a){a.length&&p.handleLoadMore(a)})},filterVideos:function(){a(".tvp-filter-reset").css("display","inline-block"),m=!0,0===d&&a("#tvp-video-container").empty(),o.videos(null,d,null).done(c.bind(function(a){d+=1,a.length&&p.handleLoadMore(a)},this))},initialize:function(){o.filters().done(c.bind(function(b){for(var d=0;d<b.length;d++){var e=b[d],f=e.code;if(f in this.filters)for(var g=["id","label","options"],h=0;h<g.length;h++)this.filters[f][g[h]]=e[g[h]]}p.addFilters(this.filters),r.Filters();var i=!1;i?a(document).on("touchstart",".tvp-filter-reset",c.bind(function(){this.reset()},this)):a(document).on("click",".tvp-filter-reset",c.bind(function(){a("#product_category").prev().find(".selected").text("Product Category"),a("#type_of_video").prev().find(".selected").text("Type of Video"),this.reset()},this))},this))}},t={updateTitle:function(b){b&&a("#video-playing-title").empty().html(b)},showPlayButton:function(){a("#html5-play-button").show().on("click",function(){window.TVPlayer.play(),a(this).hide()})},buildVideoData:function(a){var b=a.asset||{};b.sources=b.sources||[{file:b.videoId}],b.type=b.type||"youtube";var c=TVSite.channelVideosData,d="";return"object"!=typeof c&&"undefined"!=typeof c.id&&(d=c.id),b.analyticsObj={pg:TVSite.channelId||d,vd:a.id,li:TVSite.loginId},b},playVideo:function(a){if(a){u.destroy(),u.initialize({videoId:a.id,channelId:TVSite.channelId});var b=t.buildVideoData(a);isMobile?(TVPlayer.cueVideo(b),"youtube"!=b.type&&t.showPlayButton()):TVPlayer.loadVideo(b);var c=t.getVideoUrl(a);t.updateSiteUrlAndTitle(c,a.title),t.updateSocialShareLink(c,a)}},updateSiteUrlAndTitle:function(a,b){var c=window.location.protocol+"//"+window.location.host+a;c&&window.history&&history.pushState&&(history.pushState({state:1},null,c),"string"==typeof b&&(b=b),document.title=b)},updateSocialShareLink:function(b,c){a(".facebook").attr("href",function(a,c){return"https://www.facebook.com/sharer/sharer.php?u="+window.location.protocol+"//"+window.location.host+b}),a(".twitter").attr("href",function(a,d){return"https://twitter.com/share?text="+c.title+"%20%7C%0A&url="+window.location.protocol+"//"+window.location.host+b})},getVideoUrl:function(a){var b;if("undefined"!=typeof a.url)b=a.url;else{var c=TVSite.channelVideosData,d="/"+c.id+"-"+a.id,e="";a.titleTextEncoded&&a.titleTextEncoded.length>0&&(e="/"+a.titleTextEncoded);var f="";c.titleTextEncoded&&c.titleTextEncoded.length>0&&(f="/"+c.titleTextEncoded),b=f+e+d}return b},resizePlayer:function(){var b=a("#TVPagePlayer");!isFullScreen&&b.length&&TVPlayer.resize(b.width(),b.height())},getNextVideo:function(a,b){"undefined"!=typeof a&&"function"==typeof b&&b(a==videoList.length-1?videoList[0]:videoList[a+1])},handleNextvideo:function(a){"object"==typeof a&&(t.updateTitle(a.title),t.startPlayback(a))},getVideoIndex:function(a,b){if("undefined"!=typeof a&&"function"==typeof b){var c=0;for(c;c<videoList.length;c++)if(a==videoList[c].id)return b(c);b(null)}},handleAutoNext:function(){t.updateVideoElements(),t.getVideoIndex(activeVideoId,function(b){t.getNextVideo(b,a.proxy(t.handleNextvideo)),v.initialize({videoId:activeVideoId})})},startPlayback:function(b){b&&"object"==typeof b&&(t.playVideo(b),activeVideoId=b.id,o.products(activeVideoId).done(function(b){p.renderProd(b,"#mobile-products-wrapper",a("#mobileProduct").html()),p.renderProd(b,"#desktop-products-wrapper",a("#desktopProduct").html()),p.renderProd(b,"#desktop-products-pop-ups",a("#productPopup").html())}),t.updateTitle(b.title))},handlePlayerReady:function(){if(videoList=TVSite.channelVideosData.videos,t.resizePlayer(),initialPlay&&"channelVideosData"in TVSite){var a=TVSite.channelVideosData.video;t.startPlayback(a),initialPlay=!1}},handlePlayerStateChange:function(a){"tvp:media:videoended"==a&&TVSite.isPlayerPage&&t.handleAutoNext()},updateVideoElements:function(){}},u={status:!1,products:null,queue:{},productTemplate:'<a id="{id}" href="{data.linkUrl}" data-video-id="{entityIdParent}" target="_blank" class="in-time-product"><span class="in-time-unit in-time-title">{title}</span><span class="in-time-unit in-time-cta">VIEW DETAILS</span></a>',initialize:function(a){this.settings=a||{},this.setElement(),this.initializeProducts(),this.status=!0},setElement:function(){a("<div/>").attr("id","in-time-products").prependTo("#player-holder"),this.$el=a("#in-time-products")},getSpotTimeUrl:function(){if("channelId"in this.settings&&"videoId"in this.settings)return TVSite.apiUrl+"spot/link/time/"+this.settings.channelId+"/"+this.settings.videoId},getProducts:function(b){if(b&&"function"==typeof b)return a.ajax({url:this.getSpotTimeUrl(),dataType:"json",data:{"X-login-id":TVSite.loginId}}).done(b)},cleanPrice:function(a){if(a&&"string"==typeof a){if(a.indexOf(".")===-1)return a+".00";var b=a.split(".").pop();if(b.length>2&&b.indexOf("00")!==-1)return a.slice(0,-2);if(1===b.length)return a+"0"}},renderProducts:function(){for(var a="",b=0;b<this.products.length;++b){var c=this.products[b];"data"in c&&"string"==typeof c.data&&(c.data=JSON.parse(c.data)),a+=p.tmpl(this.productTemplate,c)}this.$el.html(a)},initializeProducts:function(){var a=this;this.getProducts(function(b,c){"success"===c&&b.length&&(a.products=b,a.renderProducts(),a.bindProductClick(),a.setQueue(),a.initializeWatcher())})},bindProductClick:function(){this.$el.find(".in-time-product").on("click",function(b){sendAnalytics({vd:a(this).data("videoId"),ct:a(this).attr("id")},"pk")})},setQueue:function(){if(this.products)for(var a=0;a<this.products.length;++a){var b=this.products[a],c=Number(b.startTime)+Number(b.duration);this.queue[b.id]=[Number(b.startTime),c]}},getPlayerTime:function(){return Math.floor(1e3*window.TVPlayer.getCurrentTime())},initializeWatcher:function(){var a=this;this.watcher=setInterval(function(){for(var b in a.queue){var c=a.getPlayerTime(),d=a.queue[b];c>d[0]&&c<d[1]&&a.showProduct(b),c<d[0]&&a.hideProduct(b),c>d[1]&&a.hideProduct(b)}},50)},hideProduct:function(a){"undefined"!==a&&this.$el.find("#"+a).css("top","-100px")},showProduct:function(a){var b=this.$el.find("#"+a);"-100px"===b.css("top")&&b.css("top","0")},destroy:function(){this.status&&(clearInterval(this.watcher),this.$el.find(".in-time-product").off(),this.$el.remove(),this.status=!1)}},v={initialize:function(a){var b=a||{};that=this,o.products(b.videoId).done(function(a){a.length&&that.renderProducts(a)})},renderProducts:function(b){var d='<li><div id="{id}" class="tvp-product-image"><div class="content" style="background-image: url({imageUrl})"></div></div></li>',e="";c.each(b,function(a,c){var f=b[c];e+=p.tmpl(d,f)}),a(".tvp-products-wrapper ul").html(e)}};a(".slider").slick({infinite:!0,speed:900,slidesToShow:3,slidesToScroll:1,responsive:[{breakpoint:768,settings:{arrows:!1,slidesToShow:4,slidesToScroll:3}}]}),r.onLoadMore(),TVSite.isChannelPage&&s.initialize(),TVSite.isPlayerPage&&(window.TVPlayer=new TVPage.player({divId:"TVPagePlayer",swf:"//appcdn.tvpage.com/player/assets/tvp/tvp-1.5.2-flash.swf",displayResolution:t.playerResolution,analytics:{tvpa:!1},techOrder:t.playerTechOrder,onReady:t.handlePlayerReady,onStateChange:t.handlePlayerStateChange,controls:{active:!0,seekBar:{progressColor:"#779050"},floater:{removeControls:["tvplogo"]}}}),BigScreen&&(BigScreen.onchange=function(){isFullScreen=!isFullScreen}),a(window).resize(function(){isFullScreen||t.resizePlayer()}),v.initialize({videoId:TVSite.channelVideosData.video.id}),a('div[itemprop="video"] meta[itemprop="uploadDate"],meta[itemprop="datePublished"]').attr("content",function(a,b){return n(b)})),a("#subscribe-header").on("click",function(b){b.preventDefault(),a("#subcribeModal").modal("show").find(".channel-title, .chkSubscribeAll").css("display","none")}),a("#subscribe-channel").on("click",function(b){return b.preventDefault(),isMobile?(window.location.href="/subscribe/"+a(this).data("channelid"),!1):void a("#subcribeModal").modal("show").find(".channel-title, .chkSubscribeAll").css("display","block")}),a("#subcribeModal").on("show.bs.modal",function(b){a(".subscribe-body").show(),a(".subscribed-body").hide()}),a(".subscribe-button").on("click",function(b){b.preventDefault(),a(".subscribe-body").hide(),a(".subscribed-body").show()}),a(".video-details .published-date").text(function(a,b){return n(b)}),a("#mobile-menu").on("click",function(b){b.preventDefault(),a("#mobile-menu-modal").modal()}),a(".mobile.collapse").on({"show.bs.collapse":function(){a(".caret").animate({borderSpacing:-180},{step:function(b,c){a(this).css({"-webkit-transform":"rotate("+b+"deg)","-moz-transform":"rotate("+b+"deg)",transform:"rotate("+b+"deg)"})},duration:"slow",complete:function(){a(this).addClass("up").removeAttr("style")}},"linear")},"hide.bs.collapse":function(){a(".caret").animate({borderSpacing:180},{step:function(b,c){a(this).css({"-webkit-transform":"rotate("+b+"deg)","-moz-transform":"rotate("+b+"deg)",transform:"rotate("+b+"deg)"})},duration:"slow",complete:function(){a(this).removeClass("up").removeAttr("style")}},"linear")}}),a("#mobile-subscribe").click(function(a){a.preventDefault(),window.location.href="/subscribe"}),a("#mobile-search").on("click",function(b){b.preventDefault(),a("#mobile-search-modal").modal()})}(jQuery,window.IScroll,window._);