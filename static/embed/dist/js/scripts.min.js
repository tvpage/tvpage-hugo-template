!function(){function a(){this.config=null}var b=function(a){return void 0===a};a.prototype.getConfigBase=function(a){var b=a||{};return{logUrl:b.logUrl||"",li:b.loginId||"",gaDomain:b.domain||""}},a.prototype.initConfig=function(a){if(b(window._tvpa))throw new Error("need _tvpa");this.config=this.getConfigBase(a),a&&a.firstPartyCookies&&a.cookieDomain&&(this.config.firstPartyCookieDomain=a.cookieDomain),_tvpa.push(["config",this.config])},a.prototype.track=function(a,c){b(a)||b(c)||_tvpa.push(["track",a,c])},window.Analytics=a}(),function(){var a={iOS:/iPad|iPhone|iPod|iPhone Simulator|iPad Simulator/.test(navigator.userAgent)&&!window.MSStream,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},isUndefined:function(a){return void 0===a},compact:function(a){for(var b in a)a.hasOwnProperty(b)&&!a[b]&&delete a[b];return a},optionsCheck:function(a){if(!a||!a.data||a.data.length<=0)throw new Error("need options")},getElement:function(a){if(!a)throw new Error("need el");return"string"==typeof a?document.getElementById(a):a}},b=function(b,c,d){a.optionsCheck(c),this.options=c,this.el=a.getElement(b),this.eventPrefix=("tvp_"+this.options.id).replace(/-/g,"_"),this.assets=[],this.instance=null,this.initialResize=!0,this.startWith=d||null,this.isFullScreen=!1};b.prototype.getPlayButtonOptions=function(){return a.compact({height:this.getOption("play_button_height"),width:this.getOption("play_button_width"),backgroundColor:this.getOption("play_button_background_color"),borderRadius:this.getOption("play_button_border_radius"),borderWidth:this.getOption("play_button_border_width"),borderColor:this.getOption("play_button_border_color"),borderStyle:this.getOption("play_button_border_style"),iconColor:this.getOption("play_button_icon_color")})},b.prototype.setControlsOptions=function(){this.controls=a.compact({active:!0,seekBar:a.compact({progressColor:this.getOption("progress_color")}),floater:a.compact({controlbarColor:this.getOption("control_bar_color"),iconColor:this.getOption("icon_color"),removeControls:this.getOption("remove_controls")}),playbutton:this.getPlayButtonOptions(),overlayColor:this.getOption("overlay_color"),overlayOpacity:this.getOption("overlay_opacity")})},b.prototype.setAdvertisingOptions=function(){if(this.options.advertising&&!a.isEmpty(this.options.advertising)){var b=this.options.advertising;this.advertising=a.compact({enabled:!!b.enabled,adServerUrl:b.adserverurl||null,adTimeout:b.adtimeout||"2000",maxAds:b.maxads||"100",adInterval:a.isUndefined(b.adinterval)?"0":String(b.adinterval)})}},b.prototype.shallCue=function(b){return a.isMobile||b&&!this.autonext||!this.autoplay},b.prototype.play=function(a,b){this.shallCue(b)?this.instance.cueVideo(a):this.instance.loadVideo(a)},b.prototype.controlBarZindex=function(){var a=this.el.querySelector("#ControlBarFloater");a&&a.parentNode&&(a.parentNode.style.zIndex="9999")},b.prototype.getParentSize=function(a){var b=this.el.parentNode,c=null;return"width"===a?c=b.offsetWidth:"height"===a&&(c=b.offsetHeight),c},b.prototype.resize=function(){if(this.getParentSize){var a=arguments[0]||this.getParentSize("width"),b=arguments[1]||this.getParentSize("height");this.instance&&!this.isFullScreen&&this.instance.resize(a,b),this.initialResize=!1,this.onResize&&this.onResize(this.initialResize,[a,b])}},b.prototype.handleResize=function(){var b=this;if(window.location!==window.parent.location&&a.iOS){var c=function(a){if(a&&a.data&&a.data.event&&b.eventPrefix+":external_resize"===a.data.event){var c=a.data.size||[];console.log(c),b.resize(c[0],c[1])}};window.removeEventListener("message",c,!1),window.addEventListener("message",c,!1)}else{var d=function(){b.resize.call(b)};window.removeEventListener("resize",d,!1),window.addEventListener("resize",d,!1)}},b.prototype.analyticsConfig=function(){var a=this.options,b=a.loginId||a.loginid,c={domain:location.hostname||"",logUrl:a.api_base_url+"/__tvpa.gif",loginId:b};a.firstPartyCookies&&a.cookieDomain&&(c.firstPartyCookieDomain=a.cookieDomain),_tvpa.push(["config",c]),this.options.ciTrack&&_tvpa.push(["track","ci",{li:b}])},b.prototype.getCurrentAsset=function(){var a=0,b=this.assets;if(this.startWith)for(var c=0;c<b.length;c++)b[c].assetId===this.startWith&&(a=c);return this.current=a,b[this.current]},b.prototype.onReady=function(a,b){if(this.instance=b,this.resize.call(this),window.BigScreen){var c=this;BigScreen.onchange=function(){c.isFullScreen=!c.isFullScreen,c.resize()}}this.analyticsConfig(),this.controlBarZindex(),this.handleResize(),this.onPlayerReady&&this.onPlayerReady(this),this.play(this.getCurrentAsset())},b.prototype.notifyState=function(a){var b=JSON.parse(JSON.stringify(this.assets[this.current]));b.currentTime=this.instance.getCurrentTime(),this.onPlayerChange&&window.parent&&window.parent.postMessage({event:this.eventPrefix+":on_player_change",e:a,stateData:b},"*")},b.prototype.handleVideoEnded=function(){this.current++,this.assets[this.current]||(this.current=0);var a=this.assets[this.current];this.play(a,!0),this.onNext&&this.onNext(a)},b.prototype.onStateChange=function(a){this.notifyState(a),"tvp:media:videoended"===a&&this.handleVideoEnded()},b.prototype.addExtraConfig=function(b){b=b||{};for(var c=["preload","poster","overlay"],d=0;d<c.length;d++){var e=c[d];a.isUndefined(this[e])||null===this[e]||(b[e]=this[e])}return b},b.prototype.getConfig=function(){return a.compact({techOrder:this.getOption("tech_order"),mediaProviders:this.getOption("media_providers"),analytics:{tvpa:this.getOption("analytics")},apiBaseUrl:this.getOption("api_base_url"),swf:this.flashUrl,divId:this.el.id,controls:this.controls,version:this.version,advertising:this.advertising,preload:this.getOption("preload"),poster:this.getOption("poster"),overlay:this.getOption("overlay")})},b.prototype.startPlayer=function(){var b=0,c=this;!function d(){setTimeout(function(){if(a.isUndefined(window.TVPage)||a.isUndefined(window._tvpa))++b<50?d():console.warn("can't load deps");else{var e=c.getConfig();e.onReady=function(a,b){c.onReady(a,b)},e.onStateChange=function(a){c.onStateChange(a)},c.player=new TVPage.player(e)}},150)}()},b.prototype.getChannelId=function(){var a=0,b=this.options;return b.channel?a=b.channel.id:b.channelId?a=b.channelId:b.channelid&&(a=b.channelid),a},b.prototype.buildAsset=function(b){if(a.isEmpty(b))return{};var c=b.asset;return c.assetId=b.id,c.assetTitle=b.title,c.loginId=b.loginId,c.type=c.type||"youtube",c.analyticsObj={pg:b.parentId||this.getChannelId(),vd:c.assetId,li:c.loginId},c.sources=c.sources||[{file:c.videoId}],c},b.prototype.addAssets=function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.assets.push(this.buildAsset(a[b]))},b.prototype.getOption=function(b){return a.isUndefined(this.options[b])?null:this.options[b]},b.prototype.getCallable=function(a){return"function"==typeof this.options[a]?this.options[a]:null},b.prototype.setConfig=function(a){this.version=this.getOption("player_version"),this.flashUrl="//cdnjs.tvpage.com/tvplayer/tvp-"+this.version+".swf",this.autoplay=this.getOption("autoplay"),this.autonext=this.getOption("autonext"),this.onPlayerChange=this.getOption("onPlayerChange"),this.onResize=this.getCallable("onResize"),this.onNext=this.getCallable("onNext"),this.onPlayerReady=this.getCallable("onPlayerReady")},b.prototype.initialize=function(){this.setControlsOptions(),this.setAdvertisingOptions(),this.setConfig(),this.addAssets(this.options.data),this.startPlayer()},window.Player=b}();