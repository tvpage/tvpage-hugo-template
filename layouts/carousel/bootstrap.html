{{- $type := .Type -}}
{{- $defaults := getJSON (printf "themes/tvpage/defaults/%s.json" $type) -}}

{{- range $defaults.config.global -}}
{{- $.Scratch.SetInMap "configGlobal" .code .value -}}
{{- end -}}

{{- range readDir "/" -}}
	{{- if eq .Name "defaults" -}}
		{{- if (where (readDir "defaults/") "Name" (printf "%s.json" $type)) -}}
			{{- range (getJSON (printf "defaults/%s.json" $type)).option -}}
			{{- $.Scratch.SetInMap "settings" .code .value -}}
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{- range $i, $param := .Params -}}
{{- $.Scratch.SetInMap "settings" $i . -}}
{{- end -}}

(function(){

	var configGlobal = {{ $.Scratch.Get "configGlobal" | jsonify }};

	console.log(configGlobal);

	debugger;

	var config = {{ $.Scratch.Get "settings" | jsonify }};
	
	config.type = "{{ .Type }}";
	
	{{- if (getenv "HUGO_DEBUG") -}}
		config.baseUrl = "{{ trim $.Site.BaseURL "/" }}";
	{{- else -}}
		config.baseUrl = "{{ $.Site.BaseURL }}";
	{{- end -}}
	
	config.templates = {
		base: {{- (partial (printf "%s/templates/base.html" .Type) .) -}},
		videos: {
			list: {{- (partial (printf "%s/templates/videos/list.html" .Type) .) -}},
			item: {{- (partial (printf "%s/templates/videos/item.html" .Type) .) -}}
		},
		mobile: {
			base: {{- (partial (printf "%s/mobile/templates/base.html" .Type) .) -}},
			modal: {
				content: {{- (partial (printf "%s/mobile/templates/modal/content.html" .Type) .) -}}
			}
		},
		modal: {
			base: {{- (partial (printf "%s/templates/modal/base.html" .Type) .) -}}, 
			content: {{- (partial (printf "%s/templates/modal/content.html" .Type) .) -}},
			iframe: '<iframe class="tvp-iframe-modal" src="about:blank" allowfullscreen frameborder="0" scrolling="no" gesture="media"></iframe>'
		}
	};

	config.css = {
		base: {{- (partial (printf "%s/css/base.css" .Type) .) | htmlUnescape | safeHTML -}},
		mobile: {
			base: {{- (partial (printf "%s/mobile/css/base.css" .Type) .) | htmlUnescape | safeHTML -}},
			host: {{- (partial (printf "%s/mobile/css/host.css" .Type) .) | htmlUnescape | safeHTML -}},
			"host-custom": {{- (partial (printf "%s/mobile/css/host-custom.css" .Type) .) | htmlUnescape | safeHTML -}},
			"modal-content": {{- (partial (printf "%s/mobile/css/modal-content.css" .Type) .) | htmlUnescape | safeHTML -}}
		},
		host: {{- (partial (printf "%s/css/host.css" .Type) .) | htmlUnescape | safeHTML -}},
		"host-custom": {{- (partial (printf "%s/css/host-custom.css" .Type) .) | htmlUnescape | safeHTML -}},
		"modal-content": {{- (partial (printf "%s/css/modal-content.css" .Type) .) | htmlUnescape | safeHTML -}}
	};

	{{- (readFile "/themes/tvpage/static/carousel/index.js") | htmlUnescape | safeHTML -}}
	
}());