{{- $type := .Type -}}
{{- $defaults := getJSON (printf "themes/tvpage/defaults/%s.json" $type) -}}

{{- range $defaults.option -}}
{{- $.Scratch.SetInMap "config" .code .value -}}
{{- end -}}

{{- range readDir "/" -}}
	{{- if eq .Name "defaults" -}}
		{{- if (where (readDir "defaults/") "Name" (printf "%s.json" $type)) -}}
			{{- range (getJSON (printf "defaults/%s.json" $type)).option -}}
			{{- $.Scratch.SetInMap "config" .code .value -}}
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{- range $i, $param := .Params -}}
{{- $.Scratch.SetInMap "config" $i . -}}
{{- end -}}

{{- $.Scratch.Set "settings" ($.Scratch.Get "config") -}}

(function(){

	var config = {{ $.Scratch.Get "settings" | jsonify }};
	
	{{- if (getenv "HUGO_DEBUG") -}}
		config.baseUrl = "{{ trim $.Site.BaseURL "/" }}";
	{{- else -}}
		config.baseUrl = "{{ $.Site.BaseURL }}";
	{{- end -}}

	config.templates = {
		base: {{- (partial (printf "%s/templates/base.html" .Type) .) -}},
		products: {
			featured: {{- (partial (printf "%s/templates/products/featured.html" .Type) .) -}},
			list: {{- (partial (printf "%s/templates/products/list.html" .Type) .) -}},
			item: {{- (partial (printf "%s/templates/products/item.html" .Type) .) -}}
		},
		videos: {
			list: {{- (partial (printf "%s/templates/videos/list.html" .Type) .) -}},
			item: {{- (partial (printf "%s/templates/videos/item.html" .Type) .) -}}
		},
		mobile: {
			base: {{- (partial (printf "%s/mobile/templates/base.html" .Type) .) -}},
			products: {
				list: {{- (partial (printf "%s/mobile/templates/products/list.html" .Type) .) -}},
				item: {{- (partial (printf "%s/mobile/templates/products/item.html" .Type) .) -}}
			},
			videos: {
				list: {{- (partial (printf "%s/mobile/templates/videos/list.html" .Type) .) -}},
				item: {{- (partial (printf "%s/mobile/templates/videos/item.html" .Type) .) -}}
			}
		}
	};

	config.css = {
		base: {{- (partial (printf "%s/css/base.css" .Type) .) | htmlUnescape | safeHTML -}},
		host: {{- (partial (printf "%s/css/host.css" .Type) .) | htmlUnescape | safeHTML -}},
		'host-custom': {{- (partial (printf "%s/css/host-custom.css" .Type) .) | htmlUnescape | safeHTML -}},

		mobile: {
			host: {{- (partial (printf "%s/mobile/css/host.css" .Type) .) | htmlUnescape | safeHTML -}}
		}
	};

	{{- (readFile "/themes/tvpage/static/inline/index.js") | htmlUnescape | safeHTML -}}

}());