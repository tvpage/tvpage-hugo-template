{{- partial "settings.html" . -}}

<style>{{ replaceRE " +" " " (replaceRE "\n" "" (partial (printf "%s/css-base.css" .Type ) .)) | safeCSS }}</style>
<div class="tvp-player">
<div id="tvp-player-el"></div>
<svg class="tvp-play" viewBox="0 0 200 200" alt="Play video"><polygon points="70, 55 70, 145 145, 100" fill="#e57211"></polygon></svg>
</div>

<script src="//a.tvpage.com/tvpa.min.js"></script>
<script src='//appcdn.tvpage.com/player/assets/tvp/tvp-{{ ($.Scratch.Get "settings").version }}-min.js'></script>
<script src="{{.Site.BaseURL}}player.js"></script>
<script>;(function(doc){

	var settings = {{ $.Scratch.Get "settings" }},
		videoid = {{ with .Params.videoid }}{{ . }}{{ else }}''{{ end }},
		channelid = {{ with .Params.channelid }}{{ . }}{{ else }}''{{ end }},
		videos = [];

	if (videoid) {
	  videos.push({{ index $.Site.Data.videos (printf "x%s" .Params.videoid) }} || {});
	} else if (channelid) {
	  var channel = {{index $.Site.Data.channelVideos (printf "x%s_page_1" .Params.channelid)}};
	  
	  if ('undefined' !== typeof channel.data) {
	  	videos = channel.data;
	  }
	}
	
	if (!videos.length) {
		return console.log('need videos');
	}
	
	settings.data = videos;
	settings.widgetId = settings.name;
	
	new Player('tvp-player-el', settings);

}(document));</script>