{{ $channel := index $.Site.Data.channels (printf "x%s" .Params.channelid ) }}
{{ $.Scratch.Add "channelData" $channel }}
{{ if $channel }}
  {{ $.Scratch.SetInMap "settings" "channelData" $channel }}
{{ end }}
{{ $isPreview := getenv "HUGO_PREVIEW" }}
{{ $subfolder := .Site.Params.subfolder }}
{{ $baseUrl := $subfolder}}
{{ $.Scratch.Set "baseUrl" $baseUrl }}
{{ $.Scratch.Add "baseUrl" "/" }}
{{ if $isPreview }}
  {{ $baseUrl := .Site.BaseURL }}
  {{ $.Scratch.Set "baseUrl" $baseUrl }}
{{ end }}
{{ $baseUrl := $.Scratch.Get "baseUrl" }}
<main id="main-content" class="main-content">
    <div class="container">
        <div class="row">
          {{ partial (printf "%s/breadcrumbs.html" .Type) . }}
        </div>
        {{ $videoDetails := index $.Site.Data.videos (printf "x%s" .Params.videoid) }}
        {{ $.Scratch.Add "videoDetails" $videoDetails }}
        <div class="row">
          <div class="col-sm-10 col-md-10">
            <h1 id="video-playing-title" class="video-title">{{ .Title }}</h1>              
          </div>
          <div class="col-sm-2 col-md-2">
            <h1 class="products-title">Related Products</h1>            
          </div>
        </div>
        <div class="row player-product">
          <div class="col-sm-10 col-md-10">            
            {{ partial (printf "%s/player.html" .Type) .}}
          </div>
          <div class="col-sm-2 col-md-2 player-product-products">
            <div class="video-products-container">
              {{ partial (printf "%s/products.html" .Type) .}}
            </div>
          </div>
        </div>
        <div class="row container" style="position: relative">
          <h1 class="video-title-mobile">{{ .Title }} <span class="caret" data-toggle="collapse" data-target=".video-details-row.description .mobile" aria-expanded="false"></span></h1>
          <h2 class="section-header video-details-header">VIDEO DETAILS
            <div class="social-share">                
              SHARE: <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ .Permalink }}" class="
              share-icon facebook"></a>
              <a target="_blank" href="https://twitter.com/share?text={{ .Title }}&url={{ .Permalink }}" class="share-icon twitter"></a>
            </div>
          </h2>
        </div>
        <div class="row video-details">
          <div class="col-sm-12 col-md-12 video-details-row">
            <strong>Published on: <span class="published-date">{{ $videoDetails.date_created }}</span></strong>
          </div>
          <div class="col-sm-12 col-md-12 video-details-row duration">
            <strong>Duration:</strong> {{ $videoDetails.asset.prettyDuration }}
          </div>
          <div class="col-sm-12 col-md-12 video-details-row description">
            <div class="desktop">{{ replace $videoDetails.description "\n" "<br/>" | safeHTML }}</div>
            <div class="collapse mobile">{{ replace $videoDetails.description "\n" "<br/>" | safeHTML }}</div>
          </div>
          <div class="col-sm-12 col-md-12 video-details-row btn-more show-more">
            <div class="btn-more-line"></div>
            <div class="btn-more-btn-container">
              <button type="button" class="btn btn-primary btn-more-button">SHOW MORE</button>
            </div>
          </div>
        </div>
        <div class="row container">
          <h2 class="section-header channel-videos-latest-videos">LATEST VIDEOS</h2>
          <h2 class="section-header channel-videos-latest-videos-mobile">MORE VIDEOS</h2>
        </div>
        <div id="tvp-video-container" class="row">
        {{ $channelid := .Params.channelid }}
        {{ $page := index $.Site.Data.channelVideos (printf "x%s_page_1" $channelid) }}
        {{ with $page.data }}
          {{ range $i, $p := first 6 $page.data }}
            <div class="col-sm-4 col-md-4">
            {{ if $isPreview }}
              <a href="{{$baseUrl}}{{ .url }}" class="latest-video">
            {{ else }}
              <a href='{{ $subfolder }}{{ .url }}' class="latest-video">
            {{ end }}
              <div class="latest-video-thumbnail">    
                <div class="content">
                    <img {{with .asset.thumbnailUrl}} src="{{ . }}"{{else}} src='/{{ .Type }}{{ .Param "thumbdefault" }}'{{end}}
                        alt="">
                      <div class="latest-video-hover">              
                    <div class="play-icon"></div>
                  </div>
                  </div>
              </div>
              <p class="latest-video-title">
                {{- .title -}}
              </p>
              </a>
            </div>
            {{ if eq (mod (add $i 1) 3) 0 }}<div class="col-sm-12"></div>{{ end }}
          {{ end }}
        {{ end }}
        </div>
        <div class="row container btn-more load-more">
          <div class="btn-more-line"></div>
            <div class="btn-more-btn-container">
              <button type="button" class="btn btn-primary btn-more-button">LOAD MORE</button>
            </div>
        </div>
    </div>
</main>
