{{- $type := .Type -}}
{{- $defaults := (getJSON (printf "themes/tvpage/defaults/%s.json" $type)).option -}}

{{- range $defaults -}}
	{{- $.Scratch.SetInMap "config" .code .value -}}
{{- end -}}

{{- range readDir "/" -}}
	{{- if eq .Name "defaults" -}}
		{{- if (where (readDir "defaults/") "Name" (printf "%s.json" $type)) -}}
			{{- range (getJSON (printf "defaults/%s.json" $type)).option -}}
			{{- $.Scratch.SetInMap "config" .code .value -}}
			{{- end -}}
		{{- end -}}
	{{- end -}}
{{- end -}}

{{- range $i, $param := .Params -}}
	{{- $.Scratch.SetInMap "config" $i $param -}}
{{- end -}}

{{- range $i, $param := .Site.Params -}}
	{{- $.Scratch.SetInMap "config" $i . -}}
{{- end -}}

{{- range $selector, $css := .Params.css -}}
	{{ $.Scratch.Add "custom-css" (printf "%s{" $selector) }}

	{{- range $code, $value := $css -}}
		{{- range (where (where $defaults "code" $code) "display" true) -}}
			{{- $.Scratch.Add "custom-css" (printf "%s:%s;" .property $value) -}}
		{{- end -}}		
	{{- end -}}

	{{ $.Scratch.Add "custom-css" "}" }}
{{- end -}}

{{- $.Scratch.Set "settings" ($.Scratch.Get "config") -}}